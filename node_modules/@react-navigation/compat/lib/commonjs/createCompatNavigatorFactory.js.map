{"version":3,"sources":["createCompatNavigatorFactory.tsx"],"names":["createCompatNavigatorFactory","createNavigator","isCompat","Error","createCompatNavigator","routeConfig","navigationConfig","Pair","order","defaultNavigationOptions","navigationOptions","parentNavigationOptions","restConfig","routeNames","undefined","Object","keys","Navigator","screenProps","parentRouteParams","React","useContext","NavigationRouteContext","params","screens","useMemo","map","name","getScreenComponent","initialParams","routeConfigItem","getScreen","screen","screenOptions","navigation","route","routeNavigationOptions","screenNavigationOptions","options","defineProperties","get","router","set"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  NavigationState,\n  PartialState,\n  ParamListBase,\n  TypedNavigator,\n  NavigationProp,\n  RouteProp,\n  NavigationRouteContext,\n} from '@react-navigation/native';\nimport CompatScreen from './CompatScreen';\nimport ScreenPropsContext from './ScreenPropsContext';\nimport createCompatNavigationProp from './createCompatNavigationProp';\nimport type { CompatScreenType, CompatRouteConfig } from './types';\n\nexport default function createCompatNavigatorFactory<\n  CreateNavigator extends () => TypedNavigator<\n    ParamListBase,\n    NavigationState,\n    {},\n    any,\n    React.ComponentType<any>\n  >\n>(createNavigator: CreateNavigator) {\n  // @ts-expect-error: isCompat may or may not exist\n  if (createNavigator.isCompat) {\n    throw new Error(\n      `The navigator is already in compat mode. You don't need to wrap it in 'createCompatNavigatorFactory'.`\n    );\n  }\n\n  const createCompatNavigator = <\n    NavigationPropType extends NavigationProp<any, any, any, any, any>,\n    ParamList extends ParamListBase = NavigationPropType extends NavigationProp<\n      infer P,\n      any,\n      any,\n      any,\n      any\n    >\n      ? P\n      : ParamListBase,\n    ScreenOptions extends {} = NavigationPropType extends NavigationProp<\n      any,\n      any,\n      any,\n      infer O\n    >\n      ? O\n      : {},\n    NavigationConfig extends {} = React.ComponentProps<\n      ReturnType<CreateNavigator>['Navigator']\n    >\n  >(\n    routeConfig: CompatRouteConfig<NavigationPropType>,\n    navigationConfig: Partial<Omit<NavigationConfig, 'screenOptions'>> & {\n      order?: Extract<keyof ParamList, string>[];\n      defaultNavigationOptions?: ScreenOptions;\n      navigationOptions?: Record<string, any>;\n    } = {}\n  ) => {\n    const Pair = createNavigator();\n\n    const {\n      order,\n      defaultNavigationOptions,\n      navigationOptions: parentNavigationOptions,\n      ...restConfig\n    } = navigationConfig;\n\n    const routeNames = order !== undefined ? order : Object.keys(routeConfig);\n\n    function Navigator({ screenProps }: { screenProps?: unknown }) {\n      const parentRouteParams = React.useContext(NavigationRouteContext)\n        ?.params;\n\n      const screens = React.useMemo(\n        () =>\n          routeNames.map((name) => {\n            let getScreenComponent: () => CompatScreenType<NavigationPropType>;\n\n            let initialParams;\n\n            const routeConfigItem = routeConfig[name];\n\n            if ('getScreen' in routeConfigItem) {\n              getScreenComponent = routeConfigItem.getScreen;\n              initialParams = routeConfigItem.params;\n            } else if ('screen' in routeConfigItem) {\n              getScreenComponent = () => routeConfigItem.screen;\n              initialParams = routeConfigItem.params;\n            } else {\n              getScreenComponent = () => routeConfigItem;\n            }\n\n            const screenOptions = ({\n              navigation,\n              route,\n            }: {\n              navigation: NavigationPropType;\n              route: RouteProp<ParamList, keyof ParamList> & {\n                state?: NavigationState | PartialState<NavigationState>;\n              };\n            }) => {\n              // @ts-expect-error: navigationOptions may exists on the component, but TS is dumb\n              const routeNavigationOptions = routeConfigItem.navigationOptions;\n              const screenNavigationOptions = getScreenComponent()\n                .navigationOptions;\n\n              if (\n                routeNavigationOptions == null &&\n                screenNavigationOptions == null\n              ) {\n                return undefined;\n              }\n\n              const options =\n                typeof routeNavigationOptions === 'function' ||\n                typeof screenNavigationOptions === 'function'\n                  ? {\n                      navigation: createCompatNavigationProp<\n                        NavigationPropType,\n                        ParamList\n                      >(navigation, route, {}),\n                      navigationOptions: defaultNavigationOptions || {},\n                      screenProps,\n                    }\n                  : {};\n\n              return {\n                ...(typeof routeNavigationOptions === 'function'\n                  ? routeNavigationOptions(options)\n                  : routeNavigationOptions),\n                ...(typeof screenNavigationOptions === 'function'\n                  ? (screenNavigationOptions as (o: any) => ScreenOptions)(\n                      options\n                    )\n                  : screenNavigationOptions),\n              } as ScreenOptions;\n            };\n\n            return (\n              <Pair.Screen\n                key={name}\n                name={name}\n                initialParams={{ ...parentRouteParams, ...initialParams }}\n                options={screenOptions}\n              >\n                {() => <CompatScreen getComponent={getScreenComponent} />}\n              </Pair.Screen>\n            );\n          }),\n        [parentRouteParams, screenProps]\n      );\n\n      return (\n        <ScreenPropsContext.Provider value={screenProps}>\n          <Pair.Navigator\n            {...(restConfig as NavigationConfig)}\n            screenOptions={defaultNavigationOptions}\n          >\n            {screens}\n          </Pair.Navigator>\n        </ScreenPropsContext.Provider>\n      );\n    }\n\n    Navigator.navigationOptions = parentNavigationOptions;\n\n    return Navigator;\n  };\n\n  Object.defineProperties(createCompatNavigator, {\n    isCompat: {\n      get() {\n        return true;\n      },\n    },\n    router: {\n      get() {\n        throw new Error(\n          \"It's no longer possible to access the router with the 'router' property.\"\n        );\n      },\n      set() {\n        throw new Error(\n          \"It's no longer possible to override the router by assigning the 'router' property.\"\n        );\n      },\n    },\n  });\n\n  return createCompatNavigator;\n}\n"]}